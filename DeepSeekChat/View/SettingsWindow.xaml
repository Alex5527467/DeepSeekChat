<Window x:Class="DeepSeekChat.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="设置" Height="650" Width="700"
        WindowStartupLocation="CenterOwner"
        Background="#1E1E1E"
        Foreground="White"
        ResizeMode="NoResize">

    <Window.Resources>

        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- 颜色资源（与主窗口一致） -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="#BB86FC"/>
        <SolidColorBrush x:Key="SecondaryBrush" Color="#03DAC6"/>
        <SolidColorBrush x:Key="DarkBackground" Color="#121212"/>
        <SolidColorBrush x:Key="CardBackground" Color="#2D2D2D"/>
        <SolidColorBrush x:Key="BorderColor" Color="#404040"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#AAAAAA"/>
        <SolidColorBrush x:Key="HoverColor" Color="#3D3D3D"/>
        <SolidColorBrush x:Key="SelectedItemBackground" Color="#3A3A3A"/>

        <!-- 列表项样式 -->
        <Style x:Key="SettingsListItemStyle" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter Content="{TemplateBinding Content}"
                                              ContentTemplate="{TemplateBinding ContentTemplate}"
                                              HorizontalAlignment="Stretch"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource HoverColor}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="{StaticResource SelectedItemBackground}"/>
                                <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                <Setter Property="BorderThickness" Value="2,0,0,0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 文本框样式 -->
        <Style x:Key="SettingsTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost"
                                          Margin="0"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 滑块样式 -->
        <Style x:Key="SettingsSliderStyle" TargetType="Slider">
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <Border Name="PART_Track"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="12"
                                    Height="8"/>
                            <Border Name="PART_Indicator"
                                    Background="{TemplateBinding Foreground}"
                                    CornerRadius="12"
                                    Height="8"
                                    HorizontalAlignment="Left"/>
                            <Border Name="Thumb"
                                    Width="16"
                                    Height="16"
                                    Background="{StaticResource SecondaryBrush}"
                                    CornerRadius="8"
                                    VerticalAlignment="Center">
                                <Border.RenderTransform>
                                    <TranslateTransform X="{TemplateBinding Value}"/>
                                </Border.RenderTransform>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 按钮样式 -->
        <Style x:Key="SettingsButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource HoverColor}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>

    <Grid Background="{StaticResource DarkBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题 -->
        <Border Grid.Row="0" 
                Background="#0D0D0D" 
                Height="60"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,0,0,1">
            <TextBlock Text="设置"
                       Foreground="{StaticResource PrimaryBrush}" 
                       FontSize="20"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>
        </Border>

        <!-- 主内容区域 -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧导航列表 -->
            <Border Grid.Column="0" 
                    Background="#0D0D0D"
                    BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="0,0,1,0">
                <ListBox x:Name="SettingsList" 
                         Background="Transparent"
                         BorderThickness="0"
                         SelectedIndex="{Binding SelectedSettingsIndex, Mode=TwoWay}"
                         ItemContainerStyle="{StaticResource SettingsListItemStyle}">
                    <ListBoxItem>
                        <StackPanel Orientation="Horizontal" Margin="8,0,0,0">
                            <TextBlock Text="🛠️" FontSize="21" Margin="0,0,12,0"/>
                            <TextBlock Text="API设置" FontSize="19"/>
                        </StackPanel>
                    </ListBoxItem>
                    <ListBoxItem>
                        <StackPanel Orientation="Horizontal" Margin="8,0,0,0">
                            <TextBlock Text="📁" FontSize="21" Margin="0,0,12,0"/>
                            <TextBlock Text="工程设置" FontSize="19"/>
                        </StackPanel>
                    </ListBoxItem>
                </ListBox>
            </Border>

            <!-- 右侧设置内容区域 -->
            <ScrollViewer Grid.Column="1" 
                          VerticalScrollBarVisibility="Auto"
                          Padding="20">
                <StackPanel>
                    <!-- API设置（默认显示） -->
                    <Border x:Name="ApiSettingsPanel"
                            Background="{StaticResource CardBackground}"
                            CornerRadius="8"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Padding="16"
                            Visibility="{Binding IsApiSettingsVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel>
                            <TextBlock Text="API设置"
                                       Foreground="{StaticResource PrimaryBrush}"
                                       FontSize="16"
                                       FontWeight="Bold"
                                       Margin="0,0,0,16"/>

                            <!-- API密钥 -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="API密钥"
                                           Foreground="{StaticResource TextPrimary}"
                                           FontSize="14"
                                           Margin="0,0,0,4"/>
                                <TextBox Text="{Binding ApiKey}"
                                         Style="{StaticResource SettingsTextBoxStyle}"
                                         ToolTip="请输入DeepSeek API密钥"/>
                            </StackPanel>

                            <!-- API基础URL -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="API基础URL"
                                           Foreground="{StaticResource TextPrimary}"
                                           FontSize="14"
                                           Margin="0,0,0,4"/>
                                <TextBox Text="{Binding ApiBaseUrl}"
                                         Style="{StaticResource SettingsTextBoxStyle}"
                                         ToolTip="API服务器地址"/>
                            </StackPanel>

                            <!-- 模型名称 -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="模型名称"
                                           Foreground="{StaticResource TextPrimary}"
                                           FontSize="14"
                                           Margin="0,0,0,4"/>
                                <TextBox Text="{Binding ModelName}"
                                         Style="{StaticResource SettingsTextBoxStyle}"
                                         ToolTip="使用的模型名称，如：deepseek-chat"/>
                            </StackPanel>

                            <!-- 最大Token数 -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="最大Token数"
                                           Foreground="{StaticResource TextPrimary}"
                                           FontSize="14"
                                           Margin="0,0,0,4"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Value="{Binding MaxTokens}"
                                            Minimum="100"
                                            Maximum="4000"
                                            TickFrequency="100"
                                            IsSnapToTickEnabled="True"
                                            Style="{StaticResource SettingsSliderStyle}"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding MaxTokens}"
                                               Foreground="{StaticResource TextSecondary}"
                                               Margin="8,0,0,0"
                                               VerticalAlignment="Center"
                                               Width="40"/>
                                </Grid>
                            </StackPanel>

                            <!-- 温度 -->
                            <StackPanel Margin="0,0,0,16">
                                <TextBlock Text="温度 (Temperature)"
                                           Foreground="{StaticResource TextPrimary}"
                                           FontSize="14"
                                           Margin="0,0,0,4"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Grid.Column="0"
                                            Value="{Binding Temperature}"
                                            Minimum="0"
                                            Maximum="2"
                                            TickFrequency="0.1"
                                            IsSnapToTickEnabled="True"
                                            Style="{StaticResource SettingsSliderStyle}"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Temperature, StringFormat={}{0:F1}}"
                                               Foreground="{StaticResource TextSecondary}"
                                               Margin="8,0,0,0"
                                               VerticalAlignment="Center"
                                               Width="40"/>
                                </Grid>
                            </StackPanel>

                            <!-- 测试连接按钮 -->
                            <Button Content="测试连接"
                                    Command="{Binding TestConnectionCommand}"
                                    Style="{StaticResource SettingsButtonStyle}"
                                    HorizontalAlignment="Left"
                                    Background="{StaticResource PrimaryBrush}"
                                    Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <!-- 工程设置 -->
                    <Border x:Name="ProjectSettingsPanel"
                            Background="{StaticResource CardBackground}"
                            CornerRadius="8"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Padding="16"
                            Visibility="{Binding IsProjectSettingsVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel>
                            <TextBlock Text="工程设置"
                                       Foreground="{StaticResource PrimaryBrush}"
                                       FontSize="16"
                                       FontWeight="Bold"
                                       Margin="0,0,0,16"/>

                            <!-- 工程路径 -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="工程路径"
                                           Foreground="{StaticResource TextPrimary}"
                                           FontSize="14"
                                           Margin="0,0,0,4"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Grid.Column="0"
                                             Text="{Binding ProjectPath}"
                                             Style="{StaticResource SettingsTextBoxStyle}"
                                             ToolTip="项目文件保存路径"/>
                                    <Button Grid.Column="1"
                                            Content="浏览"
                                            Command="{Binding BrowseProjectPathCommand}"
                                            Style="{StaticResource SettingsButtonStyle}"
                                            Margin="8,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- 底部按钮 -->
        <Border Grid.Row="2" 
                Background="#0D0D0D" 
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,1,0,0"
                Padding="16">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Cursor="">
                <!--<Button Content="取消"
                        Command="{Binding CancelCommand}"
                        Style="{StaticResource SettingsButtonStyle}"
                        Width="80"/>-->
                <Button Content="保存"
                        Command="{Binding SaveCommand}"
                        Style="{StaticResource SettingsButtonStyle}"
                        Height="30"
                        Width="80"
                        Background="{StaticResource PrimaryBrush}"
                        Foreground="White"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>